import{defineComponent as e,inject as t,ref as a,computed as n,watch as l,onMounted as o,resolveComponent as i,openBlock as s,createElementBlock as d,createVNode as r,withCtx as c,createElementVNode as u,toDisplayString as p,createCommentVNode as v,mergeProps as m,createTextVNode as g}from"vue";import{useApi as f}from"@directus/extensions-sdk";const y={class:"dynamic-post-selector"},h={class:"selected-post"},b={class:"post-title"},_={key:0,class:"post-meta"},x={key:0},k={key:0,class:"collection-warning"},w={key:1,class:"error-message"};var F=e({__name:"interface",props:{value:{},placeholder:{default:"Select a featured post..."},typeField:{default:"type"}},emits:["input"],setup(e,{emit:F}){const S=e,A=F,D=f(),j=t("values"),P=a(!1),T=a([]),E=a(null),O={guides_and_blogs:"guides_and_blogs",press_releases:"press_releases",news:"news",events:"events"},z=n(()=>{var e,t,a,n;const l=(null==j?void 0:j[S.typeField])||(null==(e=null==j?void 0:j.value)?void 0:e[S.typeField])||(null==(t=null==j?void 0:j.item)?void 0:t[S.typeField]);return console.log("ðŸ” Dynamic Post Selector Debug:"),console.log("- All form values:",j),console.log("- Looking for field:",S.typeField),console.log("- Direct access:",null==j?void 0:j[S.typeField]),console.log("- In value object:",null==(a=null==j?void 0:j.value)?void 0:a[S.typeField]),console.log("- In item object:",null==(n=null==j?void 0:j.item)?void 0:n[S.typeField]),console.log("- Final type field value:",l),console.log("- Available mapping keys:",Object.keys(O)),console.log("- Value exists in mapping?",l&&l in O),l&&l in O?O[l]:null}),I=e=>{try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return e}},L=e=>{A("input",e)},N=async()=>{if(z.value){P.value=!0,E.value=null;try{const e=await D.get(`/items/${z.value}`,{params:{filter:{status:{_eq:"published"}},fields:["id","title","date_created"],sort:["-date_created"],limit:100}});T.value=e.data.data||[],S.value&&!T.value.find(e=>e.id===S.value)&&A("input",null)}catch(e){console.error("Error fetching posts:",e),E.value=`Failed to load ${z.value} posts`,T.value=[]}finally{P.value=!1}}else T.value=[]};return l(z,()=>{N()},{immediate:!0}),l(()=>j,()=>{console.log("ðŸ”„ Values changed, recalculating collection type...")},{deep:!0}),o(()=>{N()}),(e,t)=>{const a=i("v-list-item-title"),n=i("v-list-item-subtitle"),l=i("v-list-item-content"),o=i("v-list-item"),f=i("v-select"),F=i("v-icon");return s(),d("div",y,[r(f,{"model-value":S.value,items:T.value,placeholder:e.placeholder||"Select a featured post...",loading:P.value,disabled:!z.value||P.value,"no-data-text":z.value?P.value?"Loading posts...":E.value?E.value:"No posts found":"Please select a collection type first","item-value":"id","item-text":"title","onUpdate:modelValue":L},{selection:c(({item:e})=>[u("div",h,[u("div",b,p(e.title),1),e.date_created?(s(),d("div",_,p(I(e.date_created)),1)):v("v-if",!0)])]),item:c(({item:e,props:t})=>[r(o,m(t,{class:"post-list-item"}),{default:c(()=>[r(l,null,{default:c(()=>[r(a,{class:"post-title"},{default:c(()=>[g(p(e.title),1)]),_:2},1024),r(n,{class:"post-meta"},{default:c(()=>[e.date_created?(s(),d("span",x,p(I(e.date_created)),1)):v("v-if",!0)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["model-value","items","placeholder","loading","disabled","no-data-text"]),z.value?E.value?(s(),d("div",w,[r(F,{name:"error",class:"error-icon"}),u("span",null,p(E.value),1)])):v("v-if",!0):(s(),d("div",k,[r(F,{name:"warning",class:"warning-icon"}),t[0]||(t[0]=u("span",null,"Please select a collection type first",-1))]))])}}}),S=[],A=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var i=S.indexOf(o);-1===i&&(i=S.push(o)-1,A[i]={}),a=A[i]&&A[i][n]?A[i][n]:A[i][n]=s()}else a=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var i="prepend"===n?"afterbegin":"beforeend";return o.insertAdjacentElement(i,e),e}}("\n.dynamic-post-selector[data-v-a280746d] {\n\t\twidth: 100%;\n}\n.selected-post[data-v-a280746d] {\n\t\twidth: 100%;\n}\n.post-list-item[data-v-a280746d] {\n\t\twidth: 100%;\n}\n.post-title[data-v-a280746d] {\n\t\tfont-weight: 500;\n\t\tmargin-bottom: 2px;\n}\n.post-meta[data-v-a280746d] {\n\t\tfont-size: 0.875rem;\n\t\tcolor: var(--theme--foreground-subdued);\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n\t\tmargin-top: 4px;\n}\n.post-permalink[data-v-a280746d] {\n\t\tfont-family: monospace;\n\t\tbackground: var(--theme--background-subdued);\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tfont-size: 0.8rem;\n}\n.collection-warning[data-v-a280746d],\n\t.error-message[data-v-a280746d] {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tmargin-top: 8px;\n\t\tpadding: 8px 12px;\n\t\tborder-radius: 6px;\n\t\tfont-size: 0.875rem;\n}\n.collection-warning[data-v-a280746d] {\n\t\tbackground: var(--theme--warning-background);\n\t\tcolor: var(--theme--warning);\n}\n.error-message[data-v-a280746d] {\n\t\tbackground: var(--theme--danger-background);\n\t\tcolor: var(--theme--danger);\n}\n.warning-icon[data-v-a280746d],\n\t.error-icon[data-v-a280746d] {\n\t\tflex-shrink: 0;\n}\n",{});var D={id:"dynamic-post-selector",name:"Dynamic Post Selector",icon:"article",description:"Select a post from a collection based on the block type",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a})(F,[["__scopeId","data-v-a280746d"],["__file","interface.vue"]]),options:[{field:"placeholder",name:"Placeholder",type:"string",meta:{width:"full",interface:"input"},schema:{default_value:"Select a featured post..."}},{field:"type_field",name:"Type Field",type:"string",meta:{width:"full",interface:"input",note:"Field name that contains the collection type (defaults to 'type')"},schema:{default_value:"type"}}],types:["integer","string","uuid"]};export{D as default};
