import{defineComponent as e,inject as t,ref as a,computed as n,watch as l,onMounted as o,resolveComponent as i,openBlock as s,createElementBlock as d,createVNode as r,withCtx as c,createElementVNode as u,toDisplayString as p,createCommentVNode as v}from"vue";import{useApi as m}from"@directus/extensions-sdk";const f={class:"dynamic-post-selector"},g={class:"selected-post"},b={class:"post-title"},y={key:0,class:"post-meta"},h={class:"post-option"},_={class:"post-title"},k={class:"post-meta"},x={key:0},w={key:1,class:"post-permalink"},F={key:0,class:"collection-warning"},S={key:1,class:"error-message"};var A=e({__name:"interface",props:{value:{},placeholder:{default:"Select a featured post..."},typeField:{default:"type"}},emits:["input"],setup(e,{emit:A}){const D=e,j=A,P=m(),T=t("values"),E=a(!1),O=a([]),z=a(null),I={guides_and_blogs:"guides_and_blogs",press_releases:"press_releases",news:"news",events:"events"},L=n(()=>{var e,t,a,n;const l=(null==T?void 0:T[D.typeField])||(null==(e=null==T?void 0:T.value)?void 0:e[D.typeField])||(null==(t=null==T?void 0:T.item)?void 0:t[D.typeField]);return console.log("ðŸ” Dynamic Post Selector Debug:"),console.log("- All form values:",T),console.log("- Looking for field:",D.typeField),console.log("- Direct access:",null==T?void 0:T[D.typeField]),console.log("- In value object:",null==(a=null==T?void 0:T.value)?void 0:a[D.typeField]),console.log("- In item object:",null==(n=null==T?void 0:T.item)?void 0:n[D.typeField]),console.log("- Final type field value:",l),console.log("- Available mapping keys:",Object.keys(I)),console.log("- Value exists in mapping?",l&&l in I),l&&l in I?I[l]:null}),N=n(()=>D.value&&O.value.find(e=>e.id===D.value)||null),V=e=>{try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return e}},q=e=>{j("input",e)},C=async()=>{if(L.value){E.value=!0,z.value=null;try{const e=await P.get(`/items/${L.value}`,{params:{filter:{status:{_eq:"published"}},fields:["id","title","permalink","date_created"],sort:["-date_created"],limit:100}});O.value=e.data.data||[],D.value&&!O.value.find(e=>e.id===D.value)&&j("input",null)}catch(e){console.error("Error fetching posts:",e),z.value=`Failed to load ${L.value} posts`,O.value=[]}finally{E.value=!1}}else O.value=[]};return l(L,()=>{C()},{immediate:!0}),l(()=>T,()=>{console.log("ðŸ”„ Values changed, recalculating collection type...")},{deep:!0}),o(()=>{C()}),(e,t)=>{const a=i("v-select"),n=i("v-icon");return s(),d("div",f,[r(a,{"model-value":N.value,items:O.value,placeholder:e.placeholder||"Select a featured post...",loading:E.value,disabled:!L.value||E.value,"no-data-text":L.value?E.value?"Loading posts...":z.value?z.value:"No posts found":"Please select a collection type first","item-value":"id","item-text":"title","onUpdate:modelValue":q},{selection:c(({item:e})=>[u("div",g,[u("div",b,p(e.title),1),e.date_created?(s(),d("div",y,p(V(e.date_created)),1)):v("v-if",!0)])]),item:c(({item:e})=>[u("div",h,[u("div",_,p(e.title),1),u("div",k,[e.date_created?(s(),d("span",x,p(V(e.date_created)),1)):v("v-if",!0),e.permalink?(s(),d("span",w,p(e.permalink),1)):v("v-if",!0)])])]),_:1},8,["model-value","items","placeholder","loading","disabled","no-data-text"]),L.value?z.value?(s(),d("div",S,[r(n,{name:"error",class:"error-icon"}),u("span",null,p(z.value),1)])):v("v-if",!0):(s(),d("div",F,[r(n,{name:"warning",class:"warning-icon"}),t[0]||(t[0]=u("span",null,"Please select a collection type first",-1))]))])}}}),D=[],j=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var i=D.indexOf(o);-1===i&&(i=D.push(o)-1,j[i]={}),a=j[i]&&j[i][n]?j[i][n]:j[i][n]=s()}else a=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var i="prepend"===n?"afterbegin":"beforeend";return o.insertAdjacentElement(i,e),e}}("\n.dynamic-post-selector[data-v-3bd8eb4f] {\n\t\twidth: 100%;\n}\n.selected-post[data-v-3bd8eb4f],\n\t.post-option[data-v-3bd8eb4f] {\n\t\twidth: 100%;\n}\n.post-title[data-v-3bd8eb4f] {\n\t\tfont-weight: 500;\n\t\tmargin-bottom: 2px;\n}\n.post-meta[data-v-3bd8eb4f] {\n\t\tfont-size: 0.875rem;\n\t\tcolor: var(--theme--foreground-subdued);\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n}\n.post-permalink[data-v-3bd8eb4f] {\n\t\tfont-family: monospace;\n\t\tbackground: var(--theme--background-subdued);\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tfont-size: 0.8rem;\n}\n.collection-warning[data-v-3bd8eb4f],\n\t.error-message[data-v-3bd8eb4f] {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tmargin-top: 8px;\n\t\tpadding: 8px 12px;\n\t\tborder-radius: 6px;\n\t\tfont-size: 0.875rem;\n}\n.collection-warning[data-v-3bd8eb4f] {\n\t\tbackground: var(--theme--warning-background);\n\t\tcolor: var(--theme--warning);\n}\n.error-message[data-v-3bd8eb4f] {\n\t\tbackground: var(--theme--danger-background);\n\t\tcolor: var(--theme--danger);\n}\n.warning-icon[data-v-3bd8eb4f],\n\t.error-icon[data-v-3bd8eb4f] {\n\t\tflex-shrink: 0;\n}\n",{});var P={id:"dynamic-post-selector",name:"Dynamic Post Selector",icon:"article",description:"Select a post from a collection based on the block type",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a})(A,[["__scopeId","data-v-3bd8eb4f"],["__file","interface.vue"]]),options:[{field:"placeholder",name:"Placeholder",type:"string",meta:{width:"full",interface:"input"},schema:{default_value:"Select a featured post..."}},{field:"type_field",name:"Type Field",type:"string",meta:{width:"full",interface:"input",note:"Field name that contains the collection type (defaults to 'type')"},schema:{default_value:"type"}}],types:["integer"]};export{P as default};
