import{defineComponent as e,inject as t,ref as a,computed as n,watch as l,onMounted as o,resolveComponent as s,openBlock as i,createElementBlock as r,createVNode as c,withCtx as d,createElementVNode as p,toDisplayString as u,createCommentVNode as v}from"vue";import{useApi as m}from"@directus/extensions-sdk";const f={class:"dynamic-post-selector"},g={class:"selected-post"},y={class:"post-title"},h={key:0,class:"post-meta"},b={class:"post-option"},_={class:"post-title"},k={class:"post-meta"},x={key:0},w={key:1,class:"post-permalink"},S={key:0,class:"collection-warning"},A={key:1,class:"error-message"};var F=e({__name:"interface",props:{value:{},placeholder:{default:"Select a featured post..."},typeField:{default:"type"}},emits:["input"],setup(e,{emit:F}){const T=e,D=F,P=m(),E=t("values"),O=a(!1),j=a([]),z=a(null),L={guides_and_blogs:"guides_and_blogs",press_releases:"press_releases",news:"news",events:"events"},N=n(()=>{const e=null==E?void 0:E[T.typeField];return console.log("ðŸ” Dynamic Post Selector Debug:"),console.log("- All form values:",E),console.log("- Looking for field:",T.typeField),console.log("- Type field value:",e),console.log("- Available mapping keys:",Object.keys(L)),console.log("- Value exists in mapping?",e&&e in L),e&&e in L?L[e]:null}),q=n(()=>T.value&&j.value.find(e=>e.id===T.value)||null),C=e=>{try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return e}},U=e=>{D("input",e)},V=async()=>{if(N.value){O.value=!0,z.value=null;try{const e=await P.get(`/items/${N.value}`,{params:{filter:{status:{_eq:"published"}},fields:["id","title","permalink","date_created"],sort:["-date_created"],limit:100}});j.value=e.data.data||[],T.value&&!j.value.find(e=>e.id===T.value)&&D("input",null)}catch(e){console.error("Error fetching posts:",e),z.value=`Failed to load ${N.value} posts`,j.value=[]}finally{O.value=!1}}else j.value=[]};return l(N,()=>{V()},{immediate:!0}),o(()=>{V()}),(e,t)=>{const a=s("v-select"),n=s("v-icon");return i(),r("div",f,[c(a,{"model-value":q.value,items:j.value,placeholder:e.placeholder||"Select a featured post...",loading:O.value,disabled:!N.value||O.value,"no-data-text":N.value?O.value?"Loading posts...":z.value?z.value:"No posts found":"Please select a collection type first","item-value":"id","item-text":"title","onUpdate:modelValue":U},{selection:d(({item:e})=>[p("div",g,[p("div",y,u(e.title),1),e.date_created?(i(),r("div",h,u(C(e.date_created)),1)):v("v-if",!0)])]),item:d(({item:e})=>[p("div",b,[p("div",_,u(e.title),1),p("div",k,[e.date_created?(i(),r("span",x,u(C(e.date_created)),1)):v("v-if",!0),e.permalink?(i(),r("span",w,u(e.permalink),1)):v("v-if",!0)])])]),_:1},8,["model-value","items","placeholder","loading","disabled","no-data-text"]),N.value?z.value?(i(),r("div",A,[c(n,{name:"error",class:"error-icon"}),p("span",null,u(z.value),1)])):v("v-if",!0):(i(),r("div",S,[c(n,{name:"warning",class:"warning-icon"}),t[0]||(t[0]=p("span",null,"Please select a collection type first",-1))]))])}}}),T=[],D=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var s=T.indexOf(o);-1===s&&(s=T.push(o)-1,D[s]={}),a=D[s]&&D[s][n]?D[s][n]:D[s][n]=i()}else a=i();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function i(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var s="prepend"===n?"afterbegin":"beforeend";return o.insertAdjacentElement(s,e),e}}("\n.dynamic-post-selector[data-v-c03e9ca6] {\n\t\twidth: 100%;\n}\n.selected-post[data-v-c03e9ca6],\n\t.post-option[data-v-c03e9ca6] {\n\t\twidth: 100%;\n}\n.post-title[data-v-c03e9ca6] {\n\t\tfont-weight: 500;\n\t\tmargin-bottom: 2px;\n}\n.post-meta[data-v-c03e9ca6] {\n\t\tfont-size: 0.875rem;\n\t\tcolor: var(--theme--foreground-subdued);\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n}\n.post-permalink[data-v-c03e9ca6] {\n\t\tfont-family: monospace;\n\t\tbackground: var(--theme--background-subdued);\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tfont-size: 0.8rem;\n}\n.collection-warning[data-v-c03e9ca6],\n\t.error-message[data-v-c03e9ca6] {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tmargin-top: 8px;\n\t\tpadding: 8px 12px;\n\t\tborder-radius: 6px;\n\t\tfont-size: 0.875rem;\n}\n.collection-warning[data-v-c03e9ca6] {\n\t\tbackground: var(--theme--warning-background);\n\t\tcolor: var(--theme--warning);\n}\n.error-message[data-v-c03e9ca6] {\n\t\tbackground: var(--theme--danger-background);\n\t\tcolor: var(--theme--danger);\n}\n.warning-icon[data-v-c03e9ca6],\n\t.error-icon[data-v-c03e9ca6] {\n\t\tflex-shrink: 0;\n}\n",{});var P={id:"dynamic-post-selector",name:"Dynamic Post Selector",icon:"article",description:"Select a post from a collection based on the block type",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a})(F,[["__scopeId","data-v-c03e9ca6"],["__file","interface.vue"]]),options:[{field:"placeholder",name:"Placeholder",type:"string",meta:{width:"full",interface:"input"},schema:{default_value:"Select a featured post..."}},{field:"type_field",name:"Type Field",type:"string",meta:{width:"full",interface:"input",note:"Field name that contains the collection type (defaults to 'type')"},schema:{default_value:"type"}}],types:["integer"]};export{P as default};
