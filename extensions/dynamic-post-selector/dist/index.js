import{defineComponent as e,inject as t,ref as a,computed as n,watch as l,onMounted as s,resolveComponent as i,openBlock as r,createElementBlock as o,createVNode as d,withCtx as c,createElementVNode as u,toDisplayString as p,createCommentVNode as v}from"vue";import{useApi as m}from"@directus/extensions-sdk";const f={class:"dynamic-post-selector"},g={class:"selected-post"},y={class:"post-title"},h={key:0,class:"post-meta"},b={class:"post-option"},_={class:"post-title"},x={class:"post-meta"},k={key:0},w={key:1,class:"post-permalink"},S={key:0,class:"collection-warning"},F={key:1,class:"error-message"};var T=e({__name:"interface",props:{value:{},placeholder:{default:"Select a featured post..."},typeField:{default:"type"}},emits:["input"],setup(e,{emit:T}){const A=e,E=T,P=m(),z=t("values"),D=a(!1),N=a([]),O=a(null),j={guides_and_blogs:"guides_and_blogs",press_releases:"press_releases",news:"news",events:"events"},q=n(()=>{const e=null==z?void 0:z[A.typeField];return e&&e in j?j[e]:null}),C=n(()=>A.value&&N.value.find(e=>e.id===A.value)||null),L=e=>{try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return e}},U=e=>{E("input",e)},$=async()=>{if(q.value){D.value=!0,O.value=null;try{const e=await P.get(`/items/${q.value}`,{params:{filter:{status:{_eq:"published"}},fields:["id","title","permalink","date_created"],sort:["-date_created"],limit:100}});N.value=e.data.data||[],A.value&&!N.value.find(e=>e.id===A.value)&&E("input",null)}catch(e){console.error("Error fetching posts:",e),O.value=`Failed to load ${q.value} posts`,N.value=[]}finally{D.value=!1}}else N.value=[]};return l(q,()=>{$()},{immediate:!0}),s(()=>{$()}),(e,t)=>{const a=i("v-select"),n=i("v-icon");return r(),o("div",f,[d(a,{"model-value":C.value,items:N.value,placeholder:e.placeholder||"Select a featured post...",loading:D.value,disabled:!q.value||D.value,"no-data-text":q.value?D.value?"Loading posts...":O.value?O.value:"No posts found":"Please select a collection type first","item-value":"id","item-text":"title","onUpdate:modelValue":U},{selection:c(({item:e})=>[u("div",g,[u("div",y,p(e.title),1),e.date_created?(r(),o("div",h,p(L(e.date_created)),1)):v("v-if",!0)])]),item:c(({item:e})=>[u("div",b,[u("div",_,p(e.title),1),u("div",x,[e.date_created?(r(),o("span",k,p(L(e.date_created)),1)):v("v-if",!0),e.permalink?(r(),o("span",w,p(e.permalink),1)):v("v-if",!0)])])]),_:1},8,["model-value","items","placeholder","loading","disabled","no-data-text"]),q.value?O.value?(r(),o("div",F,[d(n,{name:"error",class:"error-icon"}),u("span",null,p(O.value),1)])):v("v-if",!0):(r(),o("div",S,[d(n,{name:"warning",class:"warning-icon"}),t[0]||(t[0]=u("span",null,"Please select a collection type first",-1))]))])}}}),A=[],E=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,s="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var i=A.indexOf(s);-1===i&&(i=A.push(s)-1,E[i]={}),a=E[i]&&E[i][n]?E[i][n]:E[i][n]=r()}else a=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var i="prepend"===n?"afterbegin":"beforeend";return s.insertAdjacentElement(i,e),e}}("\n.dynamic-post-selector[data-v-f908a19d] {\n\t\twidth: 100%;\n}\n.selected-post[data-v-f908a19d],\n\t.post-option[data-v-f908a19d] {\n\t\twidth: 100%;\n}\n.post-title[data-v-f908a19d] {\n\t\tfont-weight: 500;\n\t\tmargin-bottom: 2px;\n}\n.post-meta[data-v-f908a19d] {\n\t\tfont-size: 0.875rem;\n\t\tcolor: var(--theme--foreground-subdued);\n\t\tdisplay: flex;\n\t\tgap: 8px;\n\t\talign-items: center;\n}\n.post-permalink[data-v-f908a19d] {\n\t\tfont-family: monospace;\n\t\tbackground: var(--theme--background-subdued);\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tfont-size: 0.8rem;\n}\n.collection-warning[data-v-f908a19d],\n\t.error-message[data-v-f908a19d] {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tmargin-top: 8px;\n\t\tpadding: 8px 12px;\n\t\tborder-radius: 6px;\n\t\tfont-size: 0.875rem;\n}\n.collection-warning[data-v-f908a19d] {\n\t\tbackground: var(--theme--warning-background);\n\t\tcolor: var(--theme--warning);\n}\n.error-message[data-v-f908a19d] {\n\t\tbackground: var(--theme--danger-background);\n\t\tcolor: var(--theme--danger);\n}\n.warning-icon[data-v-f908a19d],\n\t.error-icon[data-v-f908a19d] {\n\t\tflex-shrink: 0;\n}\n",{});var P={id:"dynamic-post-selector",name:"Dynamic Post Selector",icon:"article",description:"Select a post from a collection based on the block type",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a})(T,[["__scopeId","data-v-f908a19d"],["__file","interface.vue"]]),options:[{field:"placeholder",name:"Placeholder",type:"string",meta:{width:"full",interface:"input"},schema:{default_value:"Select a featured post..."}},{field:"type_field",name:"Type Field",type:"string",meta:{width:"full",interface:"input",note:"Field name that contains the collection type (defaults to 'type')"},schema:{default_value:"type"}}],types:["integer"]};export{P as default};
